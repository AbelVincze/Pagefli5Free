<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
		<title>PageFlip5 dev control test</title>
		<link type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Fauna+One">
		<link type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Ubuntu:400,700">
		<!--<link type="text/css" rel="stylesheet" href="css/pageflip.css">	
		<link type="text/css" rel="stylesheet" href="css/pageflip-custom.css">-->
		<script type="text/javascript" src="js/jquery-3.0.0.min.js"></script>	
		<!--<script type="text/javascript" src="js/pageflip5.js"></script>-->
		<style>
			body {
				margin: 0;
				background: #fff;
			}
			/*.pageflip-container { padding-top: 1px; }*/
			
			#main_wrapper {
				display: block;
				width: 100%;
				height: 300px;
				overflow: hidden;
				
				background: #eee
			}
		</style>
	</head>
	<body>
		<div id="main_wrapper">
		</div>

		<script type="text/javascript">


			var	__window = this,
				touchControl = 'ontouchstart' in __window,
		
				pfTEvent = {__onStart: 'touchstart', __onMove: 'touchmove', __onEnd: 'touchend'},
				pfEvent = {__onStart: 'mousedown',  __onMove: 'mousemove', __onEnd: 'mouseup'},

				TRUE = true, FALSE = !TRUE,

				touchControlled = FALSE,
				moved = FALSE,
				started = FALSE,
				disableForAll = TRUE,
				disablePinchForAll = TRUE,
				
				onStartT = function(e) { onStart( e, TRUE ); },
				onMoveT = function(e) { onMove( e, TRUE ); },
				onEndT = function(e) { onEnd( e, TRUE ); },
				onStart = function(e, touch ) {
					touchControlled = touch || FALSE;
					moved = FALSE;
					started = TRUE;
					console.log("ONSTART");
					/*if( manualFlip || autoFlip || !_MouseControl ) { return; }
					//if( $(e.target).hasClass("pf-hotspot") || $(e.target).hasClass("pf-activecontent") ) { return; }
					if( $(e.target).hasClass("pf-hotspot") || $(e.target).hasClass("pf-activecontent") || $(e.target).parents(".pf-activecontent").length ) { return; }
					setTargetCoords( e );
		
					if( touchControlled && _PinchZoom ) {
						// Watch and handle multitouch
						// Start pinch zoom
						updateMultiTouches( e, addTouch );
						if( newPinch ) {
							newPinch = FALSE;
							if( !pinching ) {
								pinching = TRUE;
								resetPinch();
								pTF = zF;
							}
						}
						//dumpTouches( "addTouch " );
						if( pinching ) { PD( e ); return; }
					}
					
					var CA = checkPreflipArea( mx,my, manualPreflip );
					if( CA && canFlip() ) {
						resetMultiTouches();
						PD(e);
						switch( CA ) {
							case "TL":
							case "BL":
								if( manualPreflip || autoPreflip ) {
									if( changeFlip( flipOrder[ flipOrder.length-1 ], 2, -1 ) ) {
										manualPreflip = autoPreflip = FALSE;
										manualFlip = TRUE;
									}
								} else if( addFlip( mx, my, 2, -1, 0 ) ) manualFlip = TRUE;
								break;
							case "TR":
							case "BR":
								if( manualPreflip || autoPreflip ) {
									if( changeFlip( flipOrder[ flipOrder.length-1 ], 2, 1 ) ) {
										manualPreflip = autoPreflip = FALSE;
										manualFlip = TRUE;
									}
								} else if( addFlip( mx, my, 2, 1, 0 ) ) manualFlip = TRUE;							
								break;
						}
					} else { 
						CA = checkControlArea( mx, my );
						if( CA && canFlip() ) {
							resetMultiTouches();
							PD(e);
							if( _SinglePageMode ) {
								if( !_RightToLeft && CA=="IL" ) CA="IR";
								if( _RightToLeft && CA=="IR" ) CA="IL";
							}
							switch( CA ) {
								case "OL":
									if( addFlip( mx, my, 2, -1, 1 ) ) manualFlip = TRUE;
									break;
								case "IR":
									if( addFlip( 	_VerticalMode? (mx<0?-leftPageW:leftPageW): -D100,
													_VerticalMode? -D100: (my<0?-leftPageH:leftPageH),
													2, -1, _SinglePageMode? 1:0 ) ) manualFlip = TRUE;
									break;
								case "OR":
									if( addFlip( mx, my, 2, 1, 1 ) ) manualFlip = TRUE;
									break;
								case "IL":
									if( addFlip( 	_VerticalMode? (mx<0?-rightPageW:rightPageW): D100,
													_VerticalMode? D100: (my<0?-rightPageH:rightPageH),
													2, 1, _SinglePageMode? 1:0 ) ) manualFlip = TRUE;
									break;
							}
						} else if( zooming && canZoom(e)) {
							PD(e);
							//console.log("Zoom Drag start!");
							zoomDrag = TRUE;
							moved = FALSE;
							var result = getZoomTargetCoords( e );
							zoomResetDrag( result.x, result.y );
						} else {
							return FALSE;
						}
					}*/
					PD(e);
				},
				onMove = function(e, touch ) {
					touchControlled = touch || FALSE;
					moved = TRUE;
					console.log("ONMOVE");
					/*
					if( autoFlip || !_MouseControl ) return;
					if( manualFlip || manualPreflip || zoomDrag || pinching) PD(e);
					
					// pinching in progress
					if( touchControlled && pinching ) {
						updatePinch();
						setPinchTargetPosition( pCX, pCY );
						//dumpTouches( "updateTouch " );
						PD(e);
						return;
					}
					
					setTargetCoords( e );
					
					//console.log( "moveto: "+mx+", "+my );
					
					if( zoomDrag ) {
						var result = getZoomTargetCoords( e );
						setZoomTargetPosition( result.x, result.y );
						return;
					}
								
					var CA = checkPreflipArea( mx,my, manualPreflip );
					if( manualPreflip && !touchControlled) {
						if( !CA ) {
							endManualFlip( flipOrder[ flipOrder.length-1 ] );
						}
					} else if( manualFlip ) {
						
					} else if ( !touchControlled && !zooming && _Preflip ) {
						if( CA ) {
							switch( CA ) {
								// preflip itt kezdodik
								case "TL":
								case "BL":
									if( addFlip(	_VerticalMode? (mx<0?-leftPageW:leftPageW): mx,
													_VerticalMode? my: (my<0?-leftPageH:leftPageH),
													3, -1, 0, __undefined, mx, my ) ) manualPreflip = TRUE;
									break;
		
								case "TR":
								case "BR":
									if( addFlip( 	_VerticalMode? (mx<0?-rightPageW:rightPageW): mx,
													_VerticalMode? my: (my<0?-rightPageH:rightPageH),
													3, 1, 0, __undefined, mx, my ) ) manualPreflip = TRUE;
									break;
							}
						}			
					}*/
					if( started || disableForAll) PD(e);
					started = FALSE;
				},
				onEnd = function(e, touch ) {
					touchControlled = touch || FALSE;
					console.log("ONEND");
					/*if( !_MouseControl ) return;
					if( $(e.target).hasClass("pf-hotspot") ) { return; }
					
					setTargetCoords( e );
					touchid = null;
					
					if( touchControlled && _PinchZoom ) {
						updateMultiTouches( e, removeTouch );
						if( newPinch && pinching ) {
							newPinch = FALSE;
							renewPinch();
						}
					}
		
					if( manualFlip || manualPreflip ) {
						PD(e);
						endManualFlip( flipOrder[ flipOrder.length-1 ] );
						changed = FALSE;
						if( !touchControlled ) triggerOnMove();
					} else if( zoomDrag ) {
						PD(e);
						zoomDrag = FALSE;
						if( !canZoom(e) ) return TRUE;
						if( !moved && checkPageArea( mx,my ) && _ClickZoom ) doubleClickZoom( e, false );//
					} else {
						if( !canZoom(e) ) return TRUE;
						//console.log( "ZOOM here? "+checkPageArea( mx,my ) );
						if( !moved && checkPageArea( mx,my ) && _ClickZoom ) {
							//console.log( "ZOOM here" );
							doubleClickZoom( e, true );
						}
		 			}*/
					if( started || disableForAll) PD(e);
					started = FALSE;
				},
					dct = 0,
					doubleClick= function( e ) {
						var now = getNow();
						if( now-dct < 300 ) {
							console.log( "DOUBLE CLICK/TAP" );
							dct = 0;
						}
						dct = now;
					},
				onKey = function(e) {
					//if( __pageflip.children(":focus").length == 0 ) return;
					if( document.activeElement.tagName.toLowerCase() != "body") return;
					console.log("ONKEY");
					/*if( !_HotKeys || e.metaKey || e.altKey || e.ctrlKey || e.shiftKey ) return;
					//if( !textInput ) {
						var ch = e.keyCode;
						switch( e.keyCode ) {
							case 37: PD(e); API.gotoPrevPage( TRUE ); break;
							case 39: PD(e); API.gotoNextPage( TRUE ); break;
							case 40: PD(e); API.gotoLastPage( TRUE ); break;
							case 38: PD(e); API.gotoFirstPage( TRUE ); break;
							case 90: PD(e); API.toggleZoom(); break;
							case 84: PD(e); API.showThumbnails(); break;
							case 65: PD(e); API.toggleAutoFlip(); break;
						}
					//}*/
					
				},
				onCancel = function(e) {
					console.log("ONCANCEL");
					//touchid = null;
					//resetMultiTouches();
					//endPinch();
					//dumpTouches( "Cancel" );
				},
				onResize = function(e) {
					console.log("RESIZE");
				},
		
				triggerOnMove = function() {
					__doc.trigger( pfEvent.__onMove );	
				},
				PD = function( e ) { return e.preventDefault(); },
				
				getNow = function() { return new Date(); },
				
				INITCONTROL = function() {
					// Reset event handlers
					var __doc = $(document),
						__win = $(__window),
						__pfs = $("#main_wrapper");
					

					__pfs.bind( pfEvent.__onStart, onStart );
					__doc.bind( pfEvent.__onMove, onMove );
					__doc.bind( pfEvent.__onEnd, onEnd );
					__doc.bind( "keydown", onKey );
					if( touchControl ) {
						//resetMultiTouches(); 
						__pfs.bind( pfTEvent.__onStart, onStartT );
						__doc.bind( pfTEvent.__onMove, onMoveT );
						__doc.bind( pfTEvent.__onEnd, onEndT );
						__doc.bind( "touchcancel", onCancel );
					}
					// Control The size of the book.			
					__win.bind( "resize", onResize );
					
					
					
				};
				
			INITCONTROL();
				

		</script>
		<!--<button onClick="console.log(pageflip.data(1))">test data 1</button>
		<button onClick="console.log(pageflip.data(3))">test data 2</button>
		
		<button onClick="pageflip.gotoPageNumber(10)">pageflip.gotoPageNumber(10)</button>
		<button onClick="pageflip.addPage(testpage1, pageflip.getPN(), false )">pageflip.addPage(testpage1)</button>
		<button onClick="pageflip.addPage(testpage2, pageflip.getPN(), false )">pageflip.addPage(testpage2)</button>
		<button onClick="pageflip.removePage( pageflip.getPN(), 1, false )">pageflip.removePage()</button>-->
		<pre id="outmsg"></pre>

	</body>
</html>